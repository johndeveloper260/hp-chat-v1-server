# Sliding Expiration Architecture

## System Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          YOUR BACKEND (Express)                          â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                â”‚      â”‚                  â”‚      â”‚                â”‚  â”‚
â”‚  â”‚  CORS Config   â”‚â”€â”€â”€â”€â”€â–¶â”‚  slidingExpirationâ”‚â”€â”€â”€â”€â”€â–¶â”‚  auth.js      â”‚  â”‚
â”‚  â”‚  (expose       â”‚      â”‚  Middleware      â”‚      â”‚  Middleware   â”‚  â”‚
â”‚  â”‚   headers)     â”‚      â”‚                  â”‚      â”‚                â”‚  â”‚
â”‚  â”‚                â”‚      â”‚  â€¢ Check exp     â”‚      â”‚  â€¢ Verify     â”‚  â”‚
â”‚  â”‚                â”‚      â”‚  â€¢ < 7 days?     â”‚      â”‚    token      â”‚  â”‚
â”‚  â”‚                â”‚      â”‚  â€¢ Generate new  â”‚      â”‚  â€¢ Attach     â”‚  â”‚
â”‚  â”‚                â”‚      â”‚  â€¢ Set header    â”‚      â”‚    req.user   â”‚  â”‚
â”‚  â”‚                â”‚      â”‚                  â”‚      â”‚                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                          â”‚                  â”‚                           â”‚
â”‚                          â”‚  Your Routes     â”‚                           â”‚
â”‚                          â”‚  /profile/me     â”‚                           â”‚
â”‚                          â”‚  /feed           â”‚                           â”‚
â”‚                          â”‚  etc...          â”‚                           â”‚
â”‚                          â”‚                  â”‚                           â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ HTTP Response
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                             â”‚
                    â–¼                             â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         WEB UI (React)        â”‚   â”‚    MOBILE APP (React Native)  â”‚
â”‚                               â”‚   â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         â”‚  â”‚   â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  Axios Interceptor      â”‚  â”‚   â”‚  â”‚  Axios Interceptor      â”‚  â”‚
â”‚  â”‚  (Response)             â”‚  â”‚   â”‚  â”‚  (Response)             â”‚  â”‚
â”‚  â”‚                         â”‚  â”‚   â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  1. Detect header       â”‚  â”‚   â”‚  â”‚  1. Detect header       â”‚  â”‚
â”‚  â”‚     X-Refresh-Token     â”‚  â”‚   â”‚  â”‚     X-Refresh-Token     â”‚  â”‚
â”‚  â”‚                         â”‚  â”‚   â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  2. Update storage      â”‚  â”‚   â”‚  â”‚  2. Update storage      â”‚  â”‚
â”‚  â”‚     localStorage        â”‚  â”‚   â”‚  â”‚     AsyncStorage        â”‚  â”‚
â”‚  â”‚                         â”‚  â”‚   â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  3. Dispatch event      â”‚  â”‚   â”‚  â”‚  3. Emit event          â”‚  â”‚
â”‚  â”‚     window.dispatchEventâ”‚  â”‚   â”‚  â”‚     EventEmitter        â”‚  â”‚
â”‚  â”‚                         â”‚  â”‚   â”‚  â”‚                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                â”‚   â”‚              â”‚                â”‚
â”‚              â–¼                â”‚   â”‚              â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         â”‚  â”‚   â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  AuthContext            â”‚  â”‚   â”‚  â”‚  AuthContext            â”‚  â”‚
â”‚  â”‚                         â”‚  â”‚   â”‚  â”‚                         â”‚  â”‚
â”‚  â”‚  â€¢ Listen for event     â”‚  â”‚   â”‚  â”‚  â€¢ Listen for event     â”‚  â”‚
â”‚  â”‚  â€¢ Update state         â”‚  â”‚   â”‚  â”‚  â€¢ Update state         â”‚  â”‚
â”‚  â”‚  â€¢ setAuthToken(new)    â”‚  â”‚   â”‚  â”‚  â€¢ setAuthToken(new)    â”‚  â”‚
â”‚  â”‚                         â”‚  â”‚   â”‚  â”‚                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚   â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request Flow with Token Refresh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚  1. GET /profile/me                          â”‚          â”‚
â”‚          â”‚  Header: x-app-identity: <token>             â”‚          â”‚
â”‚  Client  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  Server  â”‚
â”‚          â”‚                                              â”‚          â”‚
â”‚ (Web/App)â”‚                                              â”‚ (Express)â”‚
â”‚          â”‚                                              â”‚          â”‚
â”‚          â”‚              2. Middleware checks:            â”‚          â”‚
â”‚          â”‚                 â€¢ Token valid? âœ…            â”‚          â”‚
â”‚          â”‚                 â€¢ Expires in 5 days? âœ…      â”‚          â”‚
â”‚          â”‚                 â†’ Generate new token         â”‚          â”‚
â”‚          â”‚                                              â”‚          â”‚
â”‚          â”‚  3. Response:                                â”‚          â”‚
â”‚          â”‚     Body: { user: {...} }                    â”‚          â”‚
â”‚          â”‚     Headers:                                 â”‚          â”‚
â”‚          â”‚       X-Refresh-Token: <new-token>           â”‚          â”‚
â”‚          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚          â”‚                                              â”‚          â”‚
â”‚          â”‚  4. Interceptor:                             â”‚          â”‚
â”‚          â”‚     â€¢ Detect X-Refresh-Token                 â”‚          â”‚
â”‚          â”‚     â€¢ Save to storage                        â”‚          â”‚
â”‚          â”‚     â€¢ Notify AuthContext                     â”‚          â”‚
â”‚          â”‚                                              â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Token Lifecycle

```
Day 0                                 Day 23                Day 30
â”‚                                     â”‚                     â”‚
â”‚ â—„â”€â”€â”€â”€â”€â”€â”€ Token is fresh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶â”‚â—„â”€â”€ Refresh window â”€â–¶â”‚
â”‚                                     â”‚                     â”‚
â”‚                                     â”‚                     â”‚
â”‚  No refresh needed                  â”‚  Auto-refresh       â”‚  Expired
â”‚  (> 7 days remaining)               â”‚  (< 7 days left)    â”‚  (Must login)
â”‚                                     â”‚                     â”‚
â”‚                                     â”‚                     â”‚
â”‚  Normal operation                   â”‚  New 30-day token   â”‚  401 error
â”‚                                     â”‚  issued on request  â”‚  Redirect to login
â”‚                                     â”‚                     â”‚
                                      â”‚
                                      â”‚  User makes request
                                      â”‚         â”‚
                                      â”‚         â–¼
                                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚  â”‚  Middleware  â”‚
                                      â”‚  â”‚  detects:    â”‚
                                      â”‚  â”‚  5 days left â”‚
                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚         â”‚
                                      â”‚         â–¼
                                      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚  â”‚  Generate    â”‚
                                      â”‚  â”‚  new token   â”‚
                                      â”‚  â”‚  (30 days)   â”‚
                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚         â”‚
                                      â”‚         â–¼
                                      â”‚  User continues
                                      â”‚  without interruption
                                      â”‚
                                      â”‚  New cycle begins
                                      â”‚         â”‚
                                      â–¼         â–¼
                                    Day 0  (refreshed)
```

---

## Token States & Actions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TOKEN STATE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
              â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  VALID TOKEN     â”‚            â”‚  INVALID TOKEN   â”‚
    â”‚                  â”‚            â”‚                  â”‚
    â”‚  jwt.verify() âœ… â”‚            â”‚  jwt.verify() âŒ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â”‚                               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
      â”‚               â”‚                       â”‚
      â–¼               â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ > 7 days â”‚    â”‚ < 7 days â”‚           â”‚ Expired  â”‚
â”‚ remainingâ”‚    â”‚ remainingâ”‚           â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚                       â”‚
      â”‚               â”‚                       â”‚
      â–¼               â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PASS   â”‚    â”‚ REFRESH  â”‚           â”‚  REJECT  â”‚
â”‚  through â”‚    â”‚  token   â”‚           â”‚   401    â”‚
â”‚          â”‚    â”‚          â”‚           â”‚          â”‚
â”‚ No actionâ”‚    â”‚ Send new â”‚           â”‚ Redirect â”‚
â”‚          â”‚    â”‚  token   â”‚           â”‚ to login â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Interaction (Frontend)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APP COMPONENT                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚                     AuthProvider                      â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  State:                                                â”‚ â”‚
â”‚  â”‚    â€¢ authToken                                        â”‚ â”‚
â”‚  â”‚    â€¢ user                                             â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  Methods:                                             â”‚ â”‚
â”‚  â”‚    â€¢ login(token, user)                               â”‚ â”‚
â”‚  â”‚    â€¢ logout()                                         â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  Event Listener:                                      â”‚ â”‚
â”‚  â”‚    window.addEventListener("token-refreshed", ...)    â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                                â”‚
â”‚                             â”‚ Context provided to:           â”‚
â”‚                             â”‚                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â”‚                       â”‚                       â”‚        â”‚
â”‚     â–¼                       â–¼                       â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚      â”‚              â”‚      â”‚               â”‚      â”‚      â”‚
â”‚  â”‚ Page â”‚              â”‚ Page â”‚               â”‚ Page â”‚      â”‚
â”‚  â”‚  1   â”‚              â”‚  2   â”‚               â”‚  3   â”‚      â”‚
â”‚  â”‚      â”‚              â”‚      â”‚               â”‚      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚     â”‚                       â”‚                       â”‚        â”‚
â”‚     â”‚                       â”‚                       â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                             â”‚                                â”‚
â”‚                             â”‚ All use:                       â”‚
â”‚                             â–¼                                â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                     â”‚              â”‚                         â”‚
â”‚                     â”‚ Axios Config â”‚                         â”‚
â”‚                     â”‚              â”‚                         â”‚
â”‚                     â”‚ â€¢ Interceptorâ”‚                         â”‚
â”‚                     â”‚ â€¢ Auto-token â”‚                         â”‚
â”‚                     â”‚   refresh    â”‚                         â”‚
â”‚                     â”‚              â”‚                         â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Storage Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     WEB UI (localStorage)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Key                 â”‚  Value                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  authToken           â”‚  eyJhbGciOiJIUzI1NiIsInR5...      â”‚
â”‚  user                â”‚  {"id": "123", "email": ...}      â”‚
â”‚                                                          â”‚
â”‚  Access: Synchronous                                     â”‚
â”‚  Limit:  ~5-10 MB                                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                MOBILE APP (AsyncStorage)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Key                 â”‚  Value                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  authToken           â”‚  eyJhbGciOiJIUzI1NiIsInR5...      â”‚
â”‚  user                â”‚  {"id": "123", "email": ...}      â”‚
â”‚                                                          â”‚
â”‚  Access: Asynchronous (await)                            â”‚
â”‚  Limit:  Device-dependent (usually much larger)          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY LAYERS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: HTTPS/TLS
    â”‚
    â”‚  âœ… Encrypted transport
    â”‚  âœ… Prevents token interception
    â”‚
    â–¼

Layer 2: CORS
    â”‚
    â”‚  âœ… Whitelisted origins only
    â”‚  âœ… Exposed headers configuration
    â”‚
    â–¼

Layer 3: slidingExpiration Middleware
    â”‚
    â”‚  âœ… Validates token signature
    â”‚  âœ… Only refreshes VALID tokens
    â”‚  âœ… Checks expiration window
    â”‚
    â–¼

Layer 4: auth Middleware
    â”‚
    â”‚  âœ… Verifies token
    â”‚  âœ… Attaches req.user
    â”‚  âœ… Rejects invalid/expired tokens
    â”‚
    â–¼

Layer 5: Protected Routes
    â”‚
    â”‚  âœ… Business logic
    â”‚  âœ… User-specific data
    â”‚
    â–¼

Response with optional X-Refresh-Token
```

---

## Error Handling Flow

```
Request with Token
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Middleware â”‚
â”‚   checks    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€ Token valid? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                â”‚
       â–¼ YES                            â–¼ NO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Expires in  â”‚                  â”‚   Reject    â”‚
â”‚ < 7 days?   â”‚                  â”‚   401       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                â”‚
       â”œâ”€â”€â”€ YES â”€â”€â”€â”                    â”‚
       â”‚           â”‚                    â”‚
       â–¼           â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Refresh â”‚  â”‚ Continue â”‚       â”‚  Frontend   â”‚
â”‚  token  â”‚  â”‚  request â”‚       â”‚  redirects  â”‚
â”‚         â”‚  â”‚          â”‚       â”‚  to /login  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚           â”‚
       â”‚           â”‚
       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   Process   â”‚
      â”‚   request   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Response   â”‚
      â”‚  + optional â”‚
      â”‚  X-Refresh- â”‚
      â”‚    Token    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

Made with ğŸ’™ for seamless authentication across all platforms!
